# VPX ENCODER
Соснольный враппер ffmpeg'a для кодирования webm.

####Скачать
[СКАЧАТЬ БЕСПЛАТНО БЕЗ СМС]

####Подготовка
Запусти скачанный vp9.exe из консоли, запущенной с правами Админстатора, с ключом -install.
```
vp9 -install
```
Программа:
- Качает архивчик с zeranoe ffmpeg под текущую архитектуру (x86 или x86_64)
- Распаковывает в папку установки (C:\Program Files\FFMPEG Compact)
- Прописывает в Path путь до папки установки (можно запускать ffmpeg, ffprobe, vp9 из любой папки)
- Настраивает fontconfig для хардсаба (задает системные переменные и создает fonts.conf)
- Копирует vp9.exe в папку установки

Алтернативный способ для параноиков: перед запуском установи ffmpeg, добавь путь к самому vp9.exe (для удобства) и к ffmpeg.exe, ffprobe.exe (для работы приложения) в Path, настрой фонтконфиг. Можешь воспользоваться [гайдом].

**Не забудь поставить .NET Framework 4.5**!

####Кодирование
Самые простые способы.

**Длинное видео (от 30 секунд до 4 минут)**

Отрывок из твоей любимой анимы. Можешь добавить -alimit в конец, чтобы получить в итоге видео под лимит.
```
vp9 -file "1.mkv" -subs "1.ass" -ss 01:00.000 -to 02:30.000
```
2 pass, quality good, opus 80K, 960x540 (если видео широкоформатное).

**Короткое видео (до 30-50 секунд)**

Хочешь сделать годный реакшонфейс и не выглядеть дауном с битрейтом большим чем в исходнике? Тогда используй -crf 17, это значение оптимально.
```
vp9 -file "1.mkv" -subs "1.ass" -ss 01:00.000 -to 01:30.000 -crf 17
```

Для списка команд (вызов без аргументов):
```
vp9
```

####Замечания по командам
#####-t и -ti
Можно кодить параллельно несколько webm из одного исходника. Для этого создай файл с любым названием следующего содержания:
```
00:30.000 01:35.000
01:36.000 02:00.000
```
Далее запусти vp9.exe с следующими аргументами:
```
vp9 -file 1.mkv -t тайминги.txt
```
Для того, чтобы сделать конкретно какую-то сторчку из файла, добавь -ti № строки (или строк через запятую), считая от 0.

#####-scale
Для разрешения отличного от 960x540:
```
vp9 -file 1.mkv -scale -1:720
```
Так же можно использовать значения, следующего вида: 1280:-1; 1280:720; no (если скейлить изображение не нужно).

#####-subs
В качестве параметра можно указывать не только файл, но и:
- *.ass (если файл 1.mkv, то такая запись трансофрмируется в 1.ass)
- *.DT.ass (если файл 1.mkv, то такая запись трансофрмируется в 1.DT.ass)
- same (если сабы в контейнере)

#####-crf
Поскольку расчетная формула дает завышенный битрейт для коротких видео, необходимо использовать -crf [4-63], где 4 - максимальное качество, 63 - минимальное. Ну либо можно и при обычном кодировании использовать crf, если много смен статичных сцен на динамичные.

#####-alimit и -limit
limit для указания лимита (10240KB по умолчанию):
```
vp9 -file "1.mkv" -ss 01:00.000 -to 01:30.000 -limit 10240
```
alimit для подгона под лимит (с погрешностью -alimitD 240КБ) через перекодирование видео
```
vp9 -file "1.mkv" -ss 01:00.000 -to 01:30.000 -limit 10240 -alimit
```
Не любое видео можно подогнать, обычно не получаются ролики длиной меньше минуты.

Стандартное поведение - попытка подобрать битрейт с нескольких попыток.
Также доступна функция подбора нужного значения CRF, для этого необходимо указать начальный -crf, от которого начнется подбор.

```
vp9 -file "1.mkv" -ss 01:00.000 -to 01:30.000 -alimit -crf 25
```

#####-preview и -preview_s
Есть возможность добавить превью для уже полученного видео. Для этого выбери кадр (запомни его тайминг) из видео-файла и запусти:
```
vp9 -file webm_куда_добавить_превью.webm -preview_s исходник.mkv -preview 00:30.255
```
Для того, чтобы взять превью из webm, к которому оно добавляется, не указывай -preview_s:
```
vp9 -file webm_куда_добавить_превью.webm -preview 00:30.255
```

#####-youtube
Для скачивания видео c ютубчика для дальнейшего кодирования (лучшее качество mp4):
```
vp9 -youtube https://youtube...
```

#####-crop
Для удаления черных полос:
```
vp9 -file "1.mkv" -crop
```

#####-name
Для задания префикса выходного файла:
```
vp9 -file "1.mkv" -name NEW_WEBM_
```
Получится файл: NEW_WEBM_[здесь числа, обозначающие время начала кодирования].webm

#####-af
Для использования внешнего звукового файла:
```
vp9 -file "1.mkv" -af "1.ANCROD.ac3"
```

#####-ma
Смена аудиодорожки для смены рудабчика на оригинальную дорожку и обратно (эквиваленит -map 0:x при кодировании звука):
```
vp9 -file "1.mkv" -ma 1
```

####Сторонние библиотеки
- [YoutubeExtractor] MIT License
- [Json.NET] MIT license
- [Html Agility Pack] Microsoft Public License
- [SharpCompress] Microsoft Public License

[СКАЧАТЬ БЕСПЛАТНО БЕЗ СМС]:https://github.com/CherryPerry/ffmpeg-vp9-wrap/releases
[гайдом]:https://github.com/pituz/webm-thread/wiki/installing-ffmpeg-on-windows
[YoutubeExtractor]:https://github.com/flagbug/YoutubeExtractor
[Json.NET]:http://www.newtonsoft.com/json
[Html Agility Pack]:https://htmlagilitypack.codeplex.com/
[SharpCompress]:https://sharpcompress.codeplex.com/
